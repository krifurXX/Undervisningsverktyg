<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Varför korrelerar dessa variabler?</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: system-ui, -apple-system, sans-serif;
      line-height: 1.5;
      color: #334155;
      background: #f8fafc;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 24px;
    }
    
    h1 {
      font-size: 28px;
      margin-bottom: 8px;
      color: #1e293b;
    }
    
    .subtitle {
      color: #64748b;
      font-size: 16px;
      margin-bottom: 32px;
    }
    
    .button-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 24px;
    }
    
    .type-btn {
      padding: 10px 16px;
      border-radius: 8px;
      border: none;
      background-color: #f1f5f9;
      color: #334155;
      cursor: pointer;
      font-weight: 500;
      font-size: 14px;
      transition: all 0.2s;
    }
    
    .type-btn:hover {
      background-color: #e2e8f0;
    }
    
    .type-btn.active {
      color: white;
    }
    
    .quiz-btn {
      padding: 10px 16px;
      border-radius: 8px;
      border: 2px dashed #94a3b8;
      background-color: transparent;
      color: #64748b;
      cursor: pointer;
      font-weight: 500;
      font-size: 14px;
      margin-left: auto;
    }
    
    .quiz-btn:hover {
      border-color: #64748b;
      color: #475569;
    }
    
    .card {
      background-color: white;
      border-radius: 16px;
      border: 1px solid #e2e8f0;
      overflow: hidden;
    }
    
    .card-header {
      padding: 24px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    
    .card-header h2 {
      font-size: 22px;
      margin-bottom: 4px;
    }
    
    .card-header .type-subtitle {
      color: #64748b;
      margin: 0;
    }
    
    .diagram-badge {
      padding: 8px 16px;
      background-color: white;
      border-radius: 8px;
      font-family: monospace;
      font-size: 16px;
    }
    
    .card-body {
      padding: 24px;
    }
    
    .diagram-container {
      margin-bottom: 32px;
      display: flex;
      justify-content: center;
      padding: 24px;
      background-color: #f8fafc;
      border-radius: 12px;
    }
    
    .diagram {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .diagram.vertical {
      flex-direction: column;
    }
    
    .diagram-box {
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 600;
      min-width: 50px;
      text-align: center;
      border-width: 2px;
      border-style: solid;
    }
    
    .diagram-arrow {
      font-size: 20px;
      padding: 0 8px;
    }
    
    .diagram-row {
      display: flex;
      gap: 24px;
    }
    
    .arrow-row {
      display: flex;
      gap: 40px;
      font-size: 20px;
    }
    
    .section-title {
      font-size: 16px;
      color: #334155;
      margin-bottom: 8px;
    }
    
    .description {
      line-height: 1.7;
      color: #475569;
      margin-bottom: 24px;
    }
    
    .example-box {
      background-color: #f8fafc;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 24px;
    }
    
    .example-box h3 {
      font-size: 16px;
      color: #334155;
      margin-bottom: 12px;
    }
    
    .variable-tags {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    
    .variable-tag {
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 14px;
    }
    
    .example-text {
      line-height: 1.6;
      color: #475569;
    }
    
    .diagnostic-btn {
      width: 100%;
      padding: 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;
      border-width: 2px;
      border-style: solid;
      background-color: white;
      transition: all 0.2s;
    }
    
    .diagnostic-btn.active {
      color: white;
    }
    
    .diagnostic-box {
      margin-top: 16px;
      padding: 20px;
      border-radius: 12px;
      border-left-width: 4px;
      border-left-style: solid;
      display: none;
    }
    
    .diagnostic-box.visible {
      display: block;
    }
    
    .diagnostic-box p {
      font-weight: 500;
      color: #334155;
    }
    
    .takeaway-box {
      margin-top: 24px;
      padding: 20px;
      background-color: #fffbeb;
      border-radius: 12px;
      border: 1px solid #fcd34d;
    }
    
    .takeaway-box h3 {
      font-size: 16px;
      color: #92400e;
      margin-bottom: 8px;
    }
    
    .takeaway-box p {
      line-height: 1.6;
      color: #78350f;
    }
    
    /* Quiz styles */
    .quiz-container {
      display: none;
    }
    
    .quiz-container.visible {
      display: block;
    }
    
    .main-container.hidden {
      display: none;
    }
    
    .quiz-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .quiz-header h1 {
      font-size: 24px;
    }
    
    .back-btn {
      padding: 8px 16px;
      border-radius: 6px;
      border: 1px solid #ddd;
      cursor: pointer;
      background-color: white;
      font-size: 14px;
    }
    
    .back-btn:hover {
      background-color: #f8fafc;
    }
    
    .scenario-box {
      background-color: #f8fafc;
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 24px;
    }
    
    .scenario-count {
      font-size: 14px;
      color: #64748b;
      margin-bottom: 8px;
    }
    
    .scenario-text {
      font-size: 18px;
      line-height: 1.6;
    }
    
    .quiz-question {
      font-weight: 500;
      margin-bottom: 16px;
    }
    
    .answer-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 24px;
    }
    
    @media (max-width: 600px) {
      .answer-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .answer-btn {
      padding: 16px;
      border-radius: 8px;
      border: 2px solid #e2e8f0;
      background-color: white;
      cursor: pointer;
      text-align: left;
      transition: all 0.2s;
    }
    
    .answer-btn:hover:not(:disabled) {
      border-color: #cbd5e1;
      background-color: #f8fafc;
    }
    
    .answer-btn:disabled {
      cursor: default;
    }
    
    .answer-btn .title {
      font-weight: 600;
      margin-bottom: 2px;
    }
    
    .answer-btn .subtitle {
      font-size: 13px;
      color: #64748b;
      margin: 0;
    }
    
    .answer-btn.correct {
      border-color: #10b981;
      background-color: #d1fae5;
    }
    
    .answer-btn.wrong {
      border-color: #ef4444;
      background-color: #fee2e2;
    }
    
    .feedback-box {
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 24px;
      display: none;
    }
    
    .feedback-box.visible {
      display: block;
    }
    
    .feedback-box.correct {
      background-color: #d1fae5;
    }
    
    .feedback-box.wrong {
      background-color: #fef3c7;
    }
    
    .feedback-box .result {
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .feedback-box .explanation {
      line-height: 1.6;
    }
    
    .nav-buttons {
      display: flex;
      gap: 12px;
    }
    
    .nav-btn {
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
    }
    
    .nav-btn.secondary {
      border: 1px solid #ddd;
      background-color: white;
    }
    
    .nav-btn.secondary:hover {
      background-color: #f8fafc;
    }
    
    .nav-btn.primary {
      border: none;
      background-color: #3b82f6;
      color: white;
    }
    
    .nav-btn.primary:hover {
      background-color: #2563eb;
    }
    
    .nav-btn.success {
      border: none;
      background-color: #10b981;
      color: white;
    }
    
    .nav-btn.success:hover {
      background-color: #059669;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Main explainer view -->
    <div class="main-container" id="mainContainer">
      <h1>Varför korrelerar dessa variabler?</h1>
      <p class="subtitle">Korrelation innebär inte kausalitet. Här är sex olika förklaringar till varför två variabler kan verka relaterade.</p>
      
      <div class="button-row" id="typeButtons"></div>
      
      <div class="card">
        <div class="card-header" id="cardHeader">
          <div>
            <h2 id="typeTitle"></h2>
            <p class="type-subtitle" id="typeSubtitle"></p>
          </div>
          <div class="diagram-badge" id="diagramBadge"></div>
        </div>
        
        <div class="card-body">
          <div class="diagram-container" id="diagramContainer"></div>
          
          <h3 class="section-title">Förklaring</h3>
          <p class="description" id="description"></p>
          
          <div class="example-box">
            <h3>Exempel från verkligheten</h3>
            <div class="variable-tags" id="variableTags"></div>
            <p class="example-text" id="exampleText"></p>
          </div>
          
          <button class="diagnostic-btn" id="diagnosticBtn">Visa diagnostisk fråga</button>
          <div class="diagnostic-box" id="diagnosticBox">
            <p id="diagnosticQuestion"></p>
          </div>
        </div>
      </div>
      
      <div class="takeaway-box">
        <h3>Viktigaste insikten</h3>
        <p>När du observerar en korrelation, fråga alltid: Vad är mekanismen? Kan riktningen vara omvänd? Finns det en dold tredje variabel? Tittar jag på ett selekterat urval? Kan detta vara slump?</p>
      </div>
    </div>
    
    <!-- Quiz view -->
    <div class="quiz-container" id="quizContainer">
      <div class="quiz-header">
        <h1>Testa din förståelse</h1>
        <button class="back-btn" id="backBtn">Tillbaka till förklaringar</button>
      </div>
      
      <div class="scenario-box">
        <p class="scenario-count" id="scenarioCount"></p>
        <p class="scenario-text" id="scenarioText"></p>
      </div>
      
      <p class="quiz-question">Vilken typ av korrelation är detta mest troligt?</p>
      
      <div class="answer-grid" id="answerGrid"></div>
      
      <div class="feedback-box" id="feedbackBox">
        <p class="result" id="feedbackResult"></p>
        <p class="explanation" id="feedbackExplanation"></p>
      </div>
      
      <div class="nav-buttons" id="navButtons"></div>
    </div>
  </div>

  <script>
    // Data
    const correlationTypes = [
      {
        id: 'causation',
        title: 'Äkta kausalitet',
        subtitle: 'X orsakar verkligen Y',
        diagram: 'X → Y',
        description: 'Ett direkt orsakssamband existerar. Förändringar i X leder till förändringar i Y genom en genuin mekanism.',
        example: {
          x: 'Rökning',
          y: 'Risk för lungcancer',
          explanation: 'Tobaksrök innehåller cancerframkallande ämnen som skadar lungceller och orsakar mutationer som leder till cancer.'
        },
        testQuestion: 'Om vi aktivt förändrar X, förändras då Y på motsvarande sätt?',
        color: '#10b981'
      },
      {
        id: 'reverse',
        title: 'Omvänd kausalitet',
        subtitle: 'Y orsakar egentligen X',
        diagram: 'X ← Y',
        description: 'Vi observerar att X och Y korrelerar, men vi har riktningen fel. Det är Y som orsakar X, inte tvärtom.',
        example: {
          x: 'Antal brandbilar på plats',
          y: 'Brandskador',
          explanation: 'Fler brandbilar korrelerar med större skador, inte för att bilarna orsakar skador, utan för att större bränder (Y) kräver fler brandbilar (X).'
        },
        testQuestion: 'Kan det vara så att Y inträffar först och sedan orsakar förändring i X?',
        color: '#f59e0b'
      },
      {
        id: 'confounding',
        title: 'Confounding',
        subtitle: 'En tredje variabel Z orsakar båda',
        diagram: 'X ← Z → Y',
        description: 'En dold tredje variabel påverkar både X och Y, vilket skapar en skenbar korrelation mellan dem.',
        example: {
          x: 'Glassförsäljning',
          y: 'Drunkningsolyckor',
          z: 'Sommarväder',
          explanation: 'Båda ökar på sommaren. Varmt väder (Z) får folk att köpa glass OCH bada, men glass orsakar inte drunkning.'
        },
        testQuestion: 'Finns det en tredje faktor som kan driva båda variablerna?',
        color: '#8b5cf6'
      },
      {
        id: 'coincidence',
        title: 'Slumpmässig',
        subtitle: 'Spuriös korrelation',
        diagram: 'X · · · Y',
        description: 'Med tillräckligt många variabler kommer vissa att korrelera av ren slump. Ingen kausal mekanism existerar.',
        example: {
          x: 'Antal Nicolas Cage-filmer',
          y: 'Drunkningar i pooler',
          explanation: 'Dessa korrelerar i historisk data, men det finns ingen mekanism som kopplar Hollywood-filmpremiärer till poolsäkerhet.'
        },
        testQuestion: 'Kvarstår korrelationen i ny data? Finns det någon rimlig mekanism?',
        color: '#ef4444'
      },
      {
        id: 'collider',
        title: 'Collider bias',
        subtitle: 'Selektion skapar falsk korrelation',
        diagram: 'X → Z ← Y',
        description: 'När vi selekterar eller villkorar på en variabel Z som påverkas av både X och Y, skapar vi en skenbar korrelation.',
        example: {
          x: 'Talang',
          y: 'Utseende',
          z: 'Framgång i Hollywood',
          explanation: 'Bland framgångsrika skådespelare verkar talang och utseende negativt korrelerade. Varför? Mindre attraktiva skådespelare behövde mer talang för att lyckas, och vice versa. Selektionen (framgång) skapar detta mönster.'
        },
        testQuestion: 'Tittar vi på ett selekterat urval där både X och Y påverkar selektionen?',
        color: '#ec4899'
      },
      {
        id: 'mediator',
        title: 'Medierad',
        subtitle: 'X orsakar Z, som orsakar Y',
        diagram: 'X → Z → Y',
        description: 'X orsakar verkligen Y, men genom en mellanliggande mekanism Z. Att förstå mediatorn hjälper oss förklara hur.',
        example: {
          x: 'Utbildningsnivå',
          y: 'Inkomst',
          z: 'Jobbkvalifikationer',
          explanation: 'Utbildning leder till bättre jobbkvalifikationer, som leder till högre betalda tjänster. Effekten är verklig men indirekt.'
        },
        testQuestion: 'Vad är mekanismen? Finns det ett mellansteg mellan X och Y?',
        color: '#06b6d4'
      }
    ];

    const quizScenarios = [
      {
        scenario: 'Länder med fler Nobelpristagare har också högre chokladkonsumtion per capita.',
        answer: 'confounding',
        explanation: 'Välstånd är en confounding-variabel. Rikare länder har bättre utbildningssystem (fler Nobelpris) OCH invånare som har råd med choklad.'
      },
      {
        scenario: 'Studenter som sitter längst fram i salen får bättre betyg.',
        answer: 'reverse',
        explanation: 'Troligen omvänd kausalitet. Motiverade studenter (som ändå skulle få bra betyg) väljer att sitta längst fram, snarare än att platsen orsakar bättre lärande.'
      },
      {
        scenario: 'Att ta medicin korrelerar med att vara sjuk.',
        answer: 'reverse',
        explanation: 'Klassisk omvänd kausalitet. Att vara sjuk orsakar att du tar medicin, inte tvärtom.'
      },
      {
        scenario: 'Motion minskar risken för hjärtsjukdom.',
        answer: 'causation',
        explanation: 'Äkta kausalitet som stöds av biologiska mekanismer. Motion stärker hjärtat, förbättrar cirkulationen och minskar skadligt kolesterol.'
      },
      {
        scenario: 'Bland sjukhusinlagda covid-patienter verkade rökare ha bättre utfall än icke-rökare.',
        answer: 'collider',
        explanation: 'Collider bias. Sjukhusinläggning påverkas av både rökstatus och covid-allvarlighetsgrad. Icke-rökare lades bara in om de var mycket sjuka, medan rökare lades in lättare, vilket snedvrider jämförelser.'
      },
      {
        scenario: 'Kommuner med fler poliser har högre brottslighet.',
        answer: 'reverse',
        explanation: 'Omvänd kausalitet. Hög brottslighet (Y) leder till att kommunen anställer fler poliser (X), inte tvärtom.'
      },
      {
        scenario: 'Barn med större fötter är bättre på matematik.',
        answer: 'confounding',
        explanation: 'Ålder är confounding-variabeln. Äldre barn har både större fötter OCH mer matematikundervisning. Fotstorlek orsakar inte matematikförmåga.'
      }
    ];

    // State
    let selectedType = correlationTypes[0];
    let showDiagnostic = false;
    let quizMode = false;
    let currentScenario = 0;
    let answered = null;

    // DOM elements
    const mainContainer = document.getElementById('mainContainer');
    const quizContainer = document.getElementById('quizContainer');
    const typeButtons = document.getElementById('typeButtons');
    const cardHeader = document.getElementById('cardHeader');
    const typeTitle = document.getElementById('typeTitle');
    const typeSubtitle = document.getElementById('typeSubtitle');
    const diagramBadge = document.getElementById('diagramBadge');
    const diagramContainer = document.getElementById('diagramContainer');
    const description = document.getElementById('description');
    const variableTags = document.getElementById('variableTags');
    const exampleText = document.getElementById('exampleText');
    const diagnosticBtn = document.getElementById('diagnosticBtn');
    const diagnosticBox = document.getElementById('diagnosticBox');
    const diagnosticQuestion = document.getElementById('diagnosticQuestion');
    const backBtn = document.getElementById('backBtn');
    const scenarioCount = document.getElementById('scenarioCount');
    const scenarioText = document.getElementById('scenarioText');
    const answerGrid = document.getElementById('answerGrid');
    const feedbackBox = document.getElementById('feedbackBox');
    const feedbackResult = document.getElementById('feedbackResult');
    const feedbackExplanation = document.getElementById('feedbackExplanation');
    const navButtons = document.getElementById('navButtons');

    // Functions
    function hexToRgba(hex, alpha) {
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }

    function renderTypeButtons() {
      typeButtons.innerHTML = '';
      
      correlationTypes.forEach(type => {
        const btn = document.createElement('button');
        btn.className = 'type-btn' + (selectedType.id === type.id ? ' active' : '');
        btn.textContent = type.title;
        btn.style.backgroundColor = selectedType.id === type.id ? type.color : '#f1f5f9';
        btn.onclick = () => selectType(type);
        typeButtons.appendChild(btn);
      });
      
      const quizBtn = document.createElement('button');
      quizBtn.className = 'quiz-btn';
      quizBtn.textContent = 'Starta quiz →';
      quizBtn.onclick = startQuiz;
      typeButtons.appendChild(quizBtn);
    }

    function renderDiagram(type) {
      const color = type.color;
      const boxStyle = `padding: 12px 20px; border-radius: 8px; background-color: ${hexToRgba(color, 0.1)}; border: 2px solid ${color}; font-weight: 600; min-width: 50px; text-align: center;`;
      const boxStyleHighlight = `padding: 12px 20px; border-radius: 8px; background-color: ${hexToRgba(color, 0.25)}; border: 2px solid ${color}; font-weight: 600; min-width: 50px; text-align: center;`;
      const arrowStyle = `color: ${color}; font-size: 20px; padding: 0 8px;`;
      
      let html = '';
      
      if (type.id === 'causation') {
        html = `
          <div style="display: flex; align-items: center; gap: 8px;">
            <div style="${boxStyle}">X</div>
            <span style="${arrowStyle}">→</span>
            <div style="${boxStyle}">Y</div>
          </div>
        `;
      } else if (type.id === 'reverse') {
        html = `
          <div style="display: flex; align-items: center; gap: 8px;">
            <div style="${boxStyle}">X</div>
            <span style="${arrowStyle}">←</span>
            <div style="${boxStyle}">Y</div>
          </div>
        `;
      } else if (type.id === 'confounding') {
        html = `
          <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
            <div style="${boxStyle}">Z</div>
            <div style="display: flex; gap: 40px;">
              <span style="color: ${color}; font-size: 20px;">↙</span>
              <span style="color: ${color}; font-size: 20px;">↘</span>
            </div>
            <div style="display: flex; gap: 24px;">
              <div style="${boxStyle}">X</div>
              <div style="${boxStyle}">Y</div>
            </div>
          </div>
        `;
      } else if (type.id === 'coincidence') {
        html = `
          <div style="display: flex; align-items: center; gap: 8px;">
            <div style="${boxStyle}">X</div>
            <span style="${arrowStyle} letter-spacing: 4px; opacity: 0.5;">· · ·</span>
            <div style="${boxStyle}">Y</div>
          </div>
        `;
      } else if (type.id === 'collider') {
        html = `
          <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
            <div style="display: flex; gap: 24px;">
              <div style="${boxStyle}">X</div>
              <div style="${boxStyle}">Y</div>
            </div>
            <div style="display: flex; gap: 40px;">
              <span style="color: ${color}; font-size: 20px;">↘</span>
              <span style="color: ${color}; font-size: 20px;">↙</span>
            </div>
            <div style="${boxStyleHighlight}">Z (selekterad)</div>
          </div>
        `;
      } else if (type.id === 'mediator') {
        html = `
          <div style="display: flex; align-items: center; gap: 8px;">
            <div style="${boxStyle}">X</div>
            <span style="${arrowStyle}">→</span>
            <div style="${boxStyleHighlight}">Z</div>
            <span style="${arrowStyle}">→</span>
            <div style="${boxStyle}">Y</div>
          </div>
        `;
      }
      
      diagramContainer.innerHTML = html;
    }

    function renderMainView() {
      const type = selectedType;
      
      cardHeader.style.backgroundColor = hexToRgba(type.color, 0.1);
      typeTitle.textContent = type.title;
      typeTitle.style.color = type.color;
      typeSubtitle.textContent = type.subtitle;
      diagramBadge.textContent = type.diagram;
      diagramBadge.style.color = type.color;
      diagramBadge.style.border = `1px solid ${hexToRgba(type.color, 0.3)}`;
      
      renderDiagram(type);
      
      description.textContent = type.description;
      
      let tagsHtml = `
        <span class="variable-tag" style="background-color: ${hexToRgba(type.color, 0.2)}">X: ${type.example.x}</span>
        <span class="variable-tag" style="background-color: ${hexToRgba(type.color, 0.2)}">Y: ${type.example.y}</span>
      `;
      if (type.example.z) {
        tagsHtml += `<span class="variable-tag" style="background-color: ${hexToRgba(type.color, 0.3)}">Z: ${type.example.z}</span>`;
      }
      variableTags.innerHTML = tagsHtml;
      
      exampleText.textContent = type.example.explanation;
      
      diagnosticBtn.style.color = showDiagnostic ? 'white' : type.color;
      diagnosticBtn.style.backgroundColor = showDiagnostic ? type.color : 'white';
      diagnosticBtn.style.borderColor = type.color;
      diagnosticBtn.textContent = (showDiagnostic ? 'Dölj' : 'Visa') + ' diagnostisk fråga';
      
      diagnosticBox.className = 'diagnostic-box' + (showDiagnostic ? ' visible' : '');
      diagnosticBox.style.backgroundColor = hexToRgba(type.color, 0.1);
      diagnosticBox.style.borderLeftColor = type.color;
      diagnosticQuestion.textContent = 'Fråga dig själv: ' + type.testQuestion;
      
      renderTypeButtons();
    }

    function selectType(type) {
      selectedType = type;
      showDiagnostic = false;
      renderMainView();
    }

    function toggleDiagnostic() {
      showDiagnostic = !showDiagnostic;
      renderMainView();
    }

    function startQuiz() {
      quizMode = true;
      currentScenario = 0;
      answered = null;
      mainContainer.classList.add('hidden');
      quizContainer.classList.add('visible');
      renderQuiz();
    }

    function exitQuiz() {
      quizMode = false;
      mainContainer.classList.remove('hidden');
      quizContainer.classList.remove('visible');
    }

    function renderQuiz() {
      const scenario = quizScenarios[currentScenario];
      
      scenarioCount.textContent = `Scenario ${currentScenario + 1} av ${quizScenarios.length}`;
      scenarioText.textContent = scenario.scenario;
      
      answerGrid.innerHTML = '';
      correlationTypes.forEach(type => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        
        if (answered !== null) {
          if (type.id === scenario.answer) {
            btn.classList.add('correct');
          } else if (answered === type.id) {
            btn.classList.add('wrong');
          }
          btn.disabled = true;
        }
        
        btn.innerHTML = `
          <div class="title">${type.title}</div>
          <div class="subtitle">${type.subtitle}</div>
        `;
        btn.onclick = () => answerQuestion(type.id);
        answerGrid.appendChild(btn);
      });
      
      if (answered !== null) {
        const isCorrect = answered === scenario.answer;
        feedbackBox.className = 'feedback-box visible ' + (isCorrect ? 'correct' : 'wrong');
        feedbackResult.textContent = isCorrect ? '✓ Rätt!' : '✗ Inte riktigt';
        feedbackExplanation.textContent = scenario.explanation;
        
        navButtons.innerHTML = '';
        
        if (currentScenario > 0) {
          const prevBtn = document.createElement('button');
          prevBtn.className = 'nav-btn secondary';
          prevBtn.textContent = 'Föregående';
          prevBtn.onclick = () => {
            currentScenario--;
            answered = null;
            renderQuiz();
          };
          navButtons.appendChild(prevBtn);
        }
        
        if (currentScenario < quizScenarios.length - 1) {
          const nextBtn = document.createElement('button');
          nextBtn.className = 'nav-btn primary';
          nextBtn.textContent = 'Nästa scenario';
          nextBtn.onclick = () => {
            currentScenario++;
            answered = null;
            renderQuiz();
          };
          navButtons.appendChild(nextBtn);
        } else {
          const finishBtn = document.createElement('button');
          finishBtn.className = 'nav-btn success';
          finishBtn.textContent = 'Avsluta quiz';
          finishBtn.onclick = exitQuiz;
          navButtons.appendChild(finishBtn);
        }
      } else {
        feedbackBox.className = 'feedback-box';
        navButtons.innerHTML = '';
      }
    }

    function answerQuestion(typeId) {
      if (answered !== null) return;
      answered = typeId;
      renderQuiz();
    }

    // Event listeners
    diagnosticBtn.onclick = toggleDiagnostic;
    backBtn.onclick = exitQuiz;

    // Initial render
    renderMainView();
  </script>
</body>
</html>
